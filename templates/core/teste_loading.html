{% extends 'base.html' %}

{% block title %}Teste do Sistema de Loading{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-vial me-2"></i>
                        Demonstração do Sistema de Loading
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5><i class="fas fa-info-circle me-2"></i>Como Testar</h5>
                        <p class="mb-2">O sistema de loading agora mostra <strong>porcentagem real</strong>! Teste os botões abaixo:</p>
                        <ul class="mb-0">
                            <li><strong>Progresso Automático:</strong> Cada tipo de operação tem etapas realistas</li>
                            <li><strong>Porcentagem Dinâmica:</strong> Mostra 0% até 100% com mensagens específicas</li>
                            <li><strong>Detecção Inteligente:</strong> Upload, Save, Delete, etc. têm progressos únicos</li>
                        </ul>
                    </div>

                    <!-- Botões de Teste Automático -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-magic me-2"></i>
                                Loading Automático (Baseado no Contexto)
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <button class="btn btn-success w-100" onclick="simulateAction()">
                                        <i class="fas fa-save me-2"></i>
                                        Salvar Dados
                                    </button>
                                    <small class="text-muted">Save: 4 etapas de validação</small>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-danger w-100" onclick="simulateAction()">
                                        <i class="fas fa-trash me-2"></i>
                                        Excluir Item
                                    </button>
                                    <small class="text-muted">Delete: 3 etapas de remoção</small>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-info w-100" onclick="simulateAction()">
                                        <i class="fas fa-search me-2"></i>
                                        Buscar Dados
                                    </button>
                                    <small class="text-muted">Search: 3 etapas rápidas</small>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-warning w-100" onclick="simulateAction()">
                                        <i class="fas fa-upload me-2"></i>
                                        Enviar Arquivo
                                    </button>
                                    <small class="text-muted">Upload: 5 etapas realistas</small>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-secondary w-100" onclick="simulateAction()">
                                        <i class="fas fa-cog me-2"></i>
                                        Processar
                                    </button>
                                    <small class="text-muted">Process: 4 etapas completas</small>
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-primary w-100" onclick="simulateAction()">
                                        <i class="fas fa-file-export me-2"></i>
                                        Exportar Relatório
                                    </button>
                                    <small class="text-muted">Export: 4 etapas detalhadas</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Loading Manual -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-hand-pointer me-2"></i>
                                Loading Manual (Controle Personalizado)
                            </h5>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <button class="btn btn-outline-primary w-100" onclick="showRealisticLoading()">
                                        Loading Realista
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-success w-100" onclick="showProgressLoading()">
                                        Progresso Customizado
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-warning w-100" onclick="showUploadExample()">
                                        Simular Upload
                                    </button>
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-outline-danger w-100" onclick="hideLoading()">
                                        Parar Loading
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Formulários de Teste -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-wpforms me-2"></i>
                                Loading de Formulários
                            </h5>
                            
                            <div class="row">
                                <!-- Formulário de Upload -->
                                <div class="col-md-6">
                                    <div class="card border-success">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0">Upload de Arquivo</h6>
                                        </div>
                                        <div class="card-body">
                                            <form method="post" enctype="multipart/form-data" action="#" onsubmit="return false;">
                                                <div class="mb-3">
                                                    <label class="form-label">Selecionar Arquivo:</label>
                                                    <input type="file" class="form-control" name="arquivo" accept=".xlsx,.xls,.csv">
                                                </div>
                                                <button type="submit" class="btn btn-success w-100">
                                                    <i class="fas fa-cloud-upload me-2"></i>
                                                    Enviar Arquivo
                                                </button>
                                            </form>
                                            <small class="text-muted mt-2 d-block">
                                                Detecta automaticamente upload e mostra modal
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Formulário de Busca -->
                                <div class="col-md-6">
                                    <div class="card border-info">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0">Busca Avançada</h6>
                                        </div>
                                        <div class="card-body">
                                            <form method="get" action="#" onsubmit="return false;">
                                                <div class="mb-3">
                                                    <label class="form-label">Termo de Busca:</label>
                                                    <input type="text" class="form-control" name="q" placeholder="Digite sua busca...">
                                                </div>
                                                <button type="submit" class="btn btn-info w-100">
                                                    <i class="fas fa-search me-2"></i>
                                                    Buscar Dados
                                                </button>
                                            </form>
                                            <small class="text-muted mt-2 d-block">
                                                Loading automático no botão de busca
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exemplos de JavaScript -->
                    <div class="row">
                        <div class="col-12">
                            <h5 class="text-primary mb-3">
                                <i class="fas fa-code me-2"></i>
                                Exemplos de Código JavaScript
                            </h5>
                            
                            <div class="accordion" id="codeExamples">
                                <div class="accordion-item">
                                    <h6 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example1">
                                            <i class="fas fa-code me-2"></i>
                                            Loading Simples
                                        </button>
                                    </h6>
                                    <div id="example1" class="accordion-collapse collapse" data-bs-parent="#codeExamples">
                                        <div class="accordion-body">
                                            <pre><code>// Loading com progresso automático realista
showLoading({ type: 'upload' });

// Upload terá 5 etapas:
// 10% - "Preparando arquivo..."
// 30% - "Validando formato..." 
// 60% - "Enviando dados..."
// 85% - "Processando informações..."
// 100% - "Upload concluído!"</code></pre>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h6 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example2">
                                            <i class="fas fa-code me-2"></i>
                                            Loading Personalizado
                                        </button>
                                    </h6>
                                    <div id="example2" class="accordion-collapse collapse" data-bs-parent="#codeExamples">
                                        <div class="accordion-body">
                                            <pre><code>// Loading personalizado com auto-progresso
showLoading({
    message: 'Salvando dados...',
    type: 'save'  // 4 etapas automáticas
});

// Loading sem auto-progresso
showLoading({
    message: 'Operação customizada',
    autoProgress: false,
    progress: 0
});</code></pre>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h6 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example3">
                                            <i class="fas fa-code me-2"></i>
                                            Loading com Progresso
                                        </button>
                                    </h6>
                                    <div id="example3" class="accordion-collapse collapse" data-bs-parent="#codeExamples">
                                        <div class="accordion-body">
                                            <pre><code>// Progresso manual com controle total
showLoading({ 
    progress: 0, 
    autoProgress: false,
    message: 'Iniciando...'
});

// Atualizar manualmente
updateLoadingProgress(25, 'Processando arquivo...');
updateLoadingProgress(50, 'Analisando dados...');
updateLoadingProgress(75, 'Salvando resultados...');
updateLoadingProgress(100, 'Concluído!');</code></pre>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h6 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example4">
                                            <i class="fas fa-code me-2"></i>
                                            Loading em Botão Específico
                                        </button>
                                    </h6>
                                    <div id="example4" class="accordion-collapse collapse" data-bs-parent="#codeExamples">
                                        <div class="accordion-body">
                                            <pre><code>// Aplicar loading a um botão
const btn = document.getElementById('meuBotao');
Loading.setButtonLoading(btn, {
    text: 'Salvando...',
    type: 'save'
});

// Remover loading do botão
Loading.clearButtonLoading(btn);</code></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Simular ação com delay
function simulateAction() {
    setTimeout(() => {
        // O loading será removido automaticamente pelo sistema
        console.log('Ação simulada concluída');
    }, 3000);
}

// Exemplos de loading manual
function showRealisticLoading() {
    // Mostra loading automático do tipo 'process' com progresso realista
    showLoading({ type: 'process' });
}

function showProgressLoading() {
    // Progresso manual personalizado
    showLoading({ 
        progress: 0, 
        autoProgress: false,
        message: 'Progresso Customizado',
        type: 'save'
    });
    
    let progress = 0;
    const interval = setInterval(() => {
        progress += 15;
        if (progress <= 100) {
            updateLoadingProgress(progress, `Processando: ${progress}%`);
        }
        
        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(hideLoading, 1000);
        }
    }, 400);
}

function showUploadExample() {
    // Demonstra upload com etapas realistas
    showLoading({ type: 'upload' });
}

// Log de eventos para debug
document.addEventListener('DOMContentLoaded', function() {
    console.log('🧪 Página de Teste do Loading com Progresso Real carregada!');
    console.log('🎯 Novidades:');
    console.log('   • Progresso automático por tipo de operação');
    console.log('   • Porcentagem real (0% até 100%)');
    console.log('   • Etapas realistas para cada tipo');
    console.log('📋 Métodos disponíveis:');
    console.log('   • showLoading({ type: "upload" }) - Progresso automático');
    console.log('   • showLoading({ progress: 0, autoProgress: false }) - Manual');
    console.log('   • updateLoadingProgress(progress, message)');
    console.log('   • hideLoading()');
});
</script>
{% endblock %}